<script>	var current_top = 0;	var current_left = 0;	var page_offset = 0;	var limit = 9;	var current_id_num = 0;	var image_width = 200;	var refresh_lock = false;		function addBlogShow(){		if (!refresh_lock) {			refresh_lock = true;			$.ajax({				url:"__('base_ajax_action_controller/getAllMemberBlogInformation'|site_url)__",				data:'page_offset='+page_offset+'&limit='+limit,				type: "GET",				dataType: "JSON",				async: false,				success:function(data){					for(i in data){						current_id_num++;						current_id = 'b_'+ current_id_num;						var member_blog_show = ''+													'<div class=\"member_blog_show\" id=\"'+current_id+'\">'+														'<div class=\"image\"><a href=\"__("blog/view"|site_url)__?id='+data[i].member_blog_id+'\"><img src=\"'+data[i].member_blog_image+'\" /></a></div>'+														'<div class="title">'+															'<a href=\"__("profile"|site_url)__?id='+data[i].member_id+'\" class=\"publisher\">'+data[i].member_name+'</a> 发布图书 <a href=\"__("blog/view"|site_url)__?id='+data[i].member_blog_id+'\" class=\"blog_name\">'+data[i].member_blog_name+'</a>'+														'</div>'+														'<div class=\"time\">出版时间:'+data[i].created_time+'</div>'+														'<div class=\"description\">'+data[i].content+'</div>'+														'<div class=\"number\">'+															'<div class=\"hits_number\"><span>'+data[i].visit_number+'</span>人阅读</div>'+															'<div class=\"prefer_number\"><span>'+data[i].prefer_number+'</span>人喜欢</div>'+														'</div>'+													'</div>';												$("#member_blog_list").append(member_blog_show);												$('#'+current_id).css('top',current_top);						$('#'+current_id).css('left',current_left);						$('#'+current_id).css('display','none');												//处理图片尺寸问题						//var current_image = new Image(); 						//current_image.src = data[i].activity_image;						var current_image_width = data[i].member_blog_image_width;						var current_image_height = data[i].member_blog_image_height;												image_height = (image_width/current_image_width)*current_image_height;												$('#'+current_id+' > .image > a > img').width(image_width)						$('#'+current_id+' > .image > a > img').height(image_height)												var div_height = $('#'+current_id).outerHeight();						current_content_height = current_top + div_height;						if(parseFloat($("#member_blog_list").height()) < current_content_height) {							$("#member_blog_list").height(current_content_height) ;						}												//calculate top parameter						if (current_id_num < 3) {							current_top = 0;						}else {							previous_id = '#b_'+(current_id_num + 1 - 3);							previous_div = $(previous_id);							previous_div_position = previous_div.position();							previous_div_position_top = previous_div_position.top;														current_top = parseFloat(previous_div_position_top) + parseFloat(previous_div.outerHeight()) + 20;						}																	$('#'+current_id).fadeIn("slow");	//这边会因为展开速度过慢而导致高度错误						current_left = (current_id_num%3)*250 + (current_id_num%3)*20;					}					page_offset = page_offset +  limit;					refresh_lock = false;				}			});		}	}		function getRecommendBlog(action_type){		if (action_type == 'add_blog') {			$.ajax({				url:"__('base_ajax_action_controller/getHotBlogInformation'|site_url)__",				data:'page_offset='+0+'&limit='+10,				type: "GET",				dataType: "JSON",				async: false,				success:function(data){					var n = 0;					window.recommend_blog_content = new Array();					for(i in data){						if (data[i].member_blog_name.length > 10){							data[i].member_blog_name_format = data[i].member_blog_name.substr(0,8)+'..';						}						var recommend_blog_show = '<div class=\"recommend_blog_show\" id="recommend_blog_'+n+'" >'+																'<div class=\"image\"><a href=\"__("blog/view"|site_url)__?id='+data[i].member_blog_id+'\"><img src=\"'+data[i].member_blog_image+'\" width=\"105\" height=\"105\"></a></div>'+																'<div class="context">'+																	'<div class="title"><a href="__("blog/view"|site_url)__?id='+data[i].member_blog_id+'" alt=\"'+data[i].member_blog_name+'\">'+data[i].member_blog_name_format+'</a></div>'+																	'<div class="time">出版时间: '+data[i].created_time+'</div>'+																	'<div class="publisher">作者:<a href=\"__("member"|site_url)__?id='+data[i].member_id+'\">'+data[i].member_name+'</a></div>'+																	'<div class=\"number\">'+																		'<div class=\"hits_number\"><span>'+data[i].visit_number+'</span>人阅读</div>'+																		'<div class=\"prefer_number\"><span>'+data[i].prefer_number+'</span>人喜欢</div>'+																	'</div>'+																'</div>'+															'</div>';						recommend_blog_content[n] = recommend_blog_show;						n++;					}					$("#recommend_blog_list").append(recommend_blog_content[0]);					$("#recommend_blog_list").append(recommend_blog_content[1]);										$('#recommend_blog_0,#recommend_blog_1').fadeIn('slow');										current_recommend_blog = 1;				}			});		} else {			if (action_type == 'right'){				$('#recommend_blog_list .recommend_blog_show').fadeOut('slow');				$('#recommend_blog_list .recommend_blog_show').remove();				for (i = 1; i <= 2 ; i++ ){					if (current_recommend_blog + 1 < recommend_blog_content.length) {						current_recommend_blog++;						$("#recommend_blog_list").append(recommend_blog_content[current_recommend_blog]);					} else {						current_recommend_blog = 0;						$("#recommend_blog_list").append(recommend_blog_content[current_recommend_blog]);					}				}				$('#recommend_blog_list .recommend_blog_show').fadeIn('slow');							} else if (action_type == 'left'){								if (current_recommend_blog - 1 > 0) {					current_recommend_blog = current_recommend_blog - 1;				} else {					current_recommend_blog = current_recommend_blog + recommend_blog_content.length - 1;				}									for (i = 1; i <= 2 ; i++ ){					if (current_recommend_blog - 1 >= 0) {						current_recommend_blog--;						$("#recommend_blog_list").prepend(recommend_blog_content[current_recommend_blog]);					} else {						current_recommend_blog = recommend_blog_content.length - 1;						$("#recommend_blog_list").prepend(recommend_blog_content[current_recommend_blog]);					}				}								if (current_recommend_blog + 1 <= recommend_blog_content.length - 1) {					current_recommend_blog++;				} else {					current_recommend_blog = recommend_blog_content.length - 1;				}								$('#recommend_blog_list .recommend_blog_show').fadeIn('slow');							}		}	}		$(function(){				//导航提示		$('#nav_03').css('color','#ad4c4c');				addBlogShow();		getRecommendBlog('add_blog');				$(window).scroll(function() {			if (document.body.clientHeight - document.documentElement.scrollTop -  document.documentElement.clientHeight <= 10 ){				addBlogShow();			}		});			});	</script><div id="page_frame">	<div class="left_side">		__(include file="__($template)__/layout/menu_box.tpl")__	</div>		<div class="right_side" id="blog_page">			<h4>微型书 不只是概念</h4>		<div class="banner">			<div class="poster">				<p>每一次革命，都需要一些先锋。</p>				<p>每一个先锋，都需要书籍的启迪。</p>				<br />				<p>各路主席，会长，这里有天生的领袖。</p>				<p>创始人，奉献者，这里亦有草根的华丽转身。</p>				<br />				<p>先锋，是那些敢创造故事，分享故事的人。</p>				<p>而书，是那些先锋们的故事。</p>				<p>在这里看不一样的人生，原来生活存在第n种可能。</p>						</div>		</div>				<h4 style="float:left;">推荐</h4>		<div class="write"><a href="__('blog/edit'|site_url)__">写新书</a></div>		<div class="clear"></div>		<div id="recommend_blog_list">			<div class="arrows_left"><img src="__($config.template_prefix)__images/ico/arrows_left.gif" onclick="getRecommendBlog('left')" ></div>			<div class="arrows_right"><img src="__($config.template_prefix)__images/ico/arrows_right.gif" onclick="getRecommendBlog('right')" ></div>		</div>				<h4>人生图书馆</h4>		<div id="member_blog_list">						</div>					</div></div>